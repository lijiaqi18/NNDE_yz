#################### General settings ####################
# Device settings
use_gpu: False  # whether to use the gpu

# Inference simulation settings
sim_wall_time: 36  # unit: s. The simulation wall time. The simulation will stop if the wall time is reached.
sim_num: 10  # Number of simulations to run.

# Realistic metrics generation settings
gen_realistic_metric_flag: True  # Whether to generate and save realistic metrics.
gen_realistic_metric_dict:  # What metrics to generate.
  PET: True  # Post-encroachment time.
  instant_speed: True  # Vehicle instantaneous speed
  yielding_speed_and_distance: True  # Each yielding moment calculate the yielding distance and speed with the conflicting vehicle.
  distance: True  # Vehicle distance
realistic_metric_save_folder: "data_yz/statistical-realism-ground-truth/rcu_252_ground_truth/0312_mini"
#################### Other settings ####################

# NeuralNDE model
# The parameters below are determined by your trained model
model: "transformer"  # transformer or bn_mlp
dataset: "yz_252"
history_length: 5  # number of historical steps input to the model
pred_length: 5  # number of predicted steps output by the model
m_tokens: 32  # maximum number of vehicles that can be handled by the model

# Checkpoints of the trained models (behavior modeling net, safety mapping net, etc.)
behavior_model_ckpt_dir: "data_yz/inference/252/behavior_model_ckpt/AA_rdbt_behavior_net.pt"
safety_mapper_ckpt_dir: "data_yz/inference/252/safety_mapper_ckpt/safety_mapping_net.pt"

# Whether use neural safety mapping module
use_neural_safety_mapping: True

# Whether use conflict critic module (crash critic module)
use_conflict_critic_module: True

# Other inference simulation settings
sim_resol: 0.08  # related to sample frequency (12.5 Hz) simulation resolution. unit: s
rolling_step: 1  # How many pred steps to execute during autoregression.
interpolate_flag: False # Interpolate the trajectory to a finer time resolution for better visualization.
intep_steps: 3  # Number of steps to inter between steps. E.g., resolution is 0.4s intep_steps=3 then new resolution is 0.1s

# Simulation metrics dependencies
ROI_map_dir: "data_yz/inference/rcu_252/ROIs-map"  # Used for metric analysis.
PET_configs:  # This is pixel coordinates of the basemap image
  width_start: 207  # 252 circle
  width_end:  1329 # 252 circle
  width_n: 30  # 252 circle: 6 pixel/meter, 5m*5m
  width_res: 37.4  # width_res = (width_end - width_start) / width_n
  height_start: 562  # 252 circle
  height_end: 1588  # 252 circle
  height_n: 30  # 252 circle: 6 pixel/meter, 5m*5m
  height_res: 34.2  # height_res = (height_end - height_start) / height_n

# Other save results and visualization
save_simulated_TIME_BUFF_flag: False  # Save all generated simulated trajectories
viz_flag: False  # Whether visualize the simulation.
save_viz_flag: False  # Save simulation visualizations
save_fps: 30
viz_real_buff_flag: True
interpolate_real_buff_flag: True
real_buff_intep_steps: False #已经在10ms以内
buff_video_save_path: "visualization/rcu_252/time_buff_video"

# Data needed for the simulation. E.g., map image, initial vehicle states, etc.
basemap_dir: "data_yz/inference/rcu_252/basemap/252.png"
drivable_map_dir: &drivable_map_dir "data_yz/inference/rcu_252/drivablemap/252-drivablemap.png"
sim_remove_vehicle_area_map: "data_yz/inference/rcu_252/ROIs-map/252-sim-remove-vehicle-area-map.jpg"  # E.g., exits.
entrance_map_dir: &entrance_map_dir "data_yz/inference/rcu_252/ROIs-map/entrance"  # Only needed if want to use lane_based_safety_check for initialization.
map_height: &map_height 2091  # The map height and width ratio should be consistent with the basemap and drivable map pictures.
map_width: &map_width 1896
init_traj_clips_dir: "data_yz/inference/252/simulation_initialization/initial_clips/"  # For initialization.
traffic_generator_config:
  method: Poisson  # Poisson or Random
  gen_veh_states_dir: "data_yz/inference/252/simulation_initialization/gen_veh_states/AA_rdbt/"  # The states of generated vehicle at entrance during the simulation
  check_safety_method: lane_based_safety_check  # lane_based_safety_check or uniform_safety_check
  uniform_safety_buffer: 5
  same_lane_safety_buffer: 8  # for lane based check
  different_lane_safety_buffer: 5  # for lane based check
  default_Poisson_arr_rate: 200
  sim_resol: 0.08  # Should be consistent with Behavior modeling network output resolution
  drivable_map_dir: *drivable_map_dir
  map_height: *map_height
  map_width: *map_width
  entrance_map_dir: *entrance_map_dir

# Training dataset
dataset: "yz_252"
path_to_traj_data: "data_yz/training/252/realistic_vis/train"  # Trajectory data for training

# Model settings
model: transformer  # transformer or bn_mlp
history_length: 5  # number of historical steps input to the model
pred_length: 5  # number of predicted steps output by the model
max_num_vehicles: 32  # maximum number of vehicles that can be handled by the model

# Training settings
batch_size: 32
lr: 1.0e-4  # learning rate
lr_decay_step_size: 300  # The number of training epochs to conduct lr decay. lr_scheduler.StepLR is used.
lr_decay_gamma: 0.3  # lr_scheduler.StepLR is used.
max_num_epochs: 2500  # maximum training epochs
dataloader_num_workers: 8  # num_workers

# Pre-trained safety mapping network
safety_mapper_ckpt_dir: "data_yz/training/252/safety_mapper_ckpt/safety_mapping_net.pt"
